from opentrons import protocol_api

config = {
	"PLATES": {"PCE004": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 7.2, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 17.9, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 12.8, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PCE012": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 6.1, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 11.7, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 18.4, "G5": 0, "H5": 8.7, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 21.8, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 15.6, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 91.5, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 78.2, "B11": 6.4, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 12.5, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PCE014": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 0, "G1": 8.5, "H1": 36.6, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 6.4, "H2": 8.6, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 15.4, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 26.9, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 5.1, "A6": 0, "B6": 0, "C6": 0, "D6": 21.8, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 5.8, "E8": 0, "F8": 5.7, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PCE031": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 24.7, "G1": 16.3, "H1": 0, "A2": 0, "B2": 23.9, "C2": 0, "D2": 26.7, "E2": 16.7, "F2": 0, "G2": 0, "H2": 0, "A3": 0, "B3": 29.1, "C3": 32.4, "D3": 184.8, "E3": 0, "F3": 35.7, "G3": 12.3, "H3": 0, "A4": 33.0, "B4": 0, "C4": 0, "D4": 8.1, "E4": 114.5, "F4": 0, "G4": 0, "H4": 0, "A5": 0, "B5": 24.2, "C5": 0, "D5": 0, "E5": 0, "F5": 29.3, "G5": 0, "H5": 33.2, "A6": 13.6, "B6": 13.9, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 25.0, "H6": 73.2, "A7": 29.2, "B7": 22.9, "C7": 0, "D7": 5.2, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 133.3, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "P1": {"A1": 0, "B1": 81.8, "C1": 43.4, "D1": 125.8, "E1": 90.1, "F1": 70.2, "G1": 0, "H1": 96.0, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 86.2, "G2": 14.2, "H2": 6.0, "A3": 91.4, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 15.5, "A4": 114.9, "B4": 0, "C4": 0, "D4": 183.8, "E4": 0, "F4": 44.6, "G4": 17.4, "H4": 0, "A5": 0, "B5": 0, "C5": 179.0, "D5": 0, "E5": 169.5, "F5": 5.2, "G5": 0, "H5": 0, "A6": 76.8, "B6": 0, "C6": 0, "D6": 8.0, "E6": 47.0, "F6": 0, "G6": 10.9, "H6": 32.7, "A7": 0, "B7": 7.6, "C7": 83.6, "D7": 0, "E7": 0, "F7": 34.9, "G7": 0, "H7": 122.3, "A8": 81.4, "B8": 0, "C8": 185.7, "D8": 133.4, "E8": 35.8, "F8": 134.1, "G8": 9.0, "H8": 24.6, "A9": 0, "B9": 0, "C9": 0, "D9": 92.6, "E9": 119.9, "F9": 0, "G9": 73.0, "H9": 0, "A10": 0, "B10": 128.4, "C10": 49.1, "D10": 0, "E10": 0, "F10": 0, "G10": 86.7, "H10": 0, "A11": 144.3, "B11": 173.4, "C11": 0, "D11": 0, "E11": 46.3, "F11": 86.3, "G11": 52.7, "H11": 5.3, "A12": 0, "B12": 51.1, "C12": 108.7, "D12": 155.9, "E12": 51.3, "F12": 145.7, "G12": 149.4, "H12": 50.3}, "P2": {"A1": 106.0, "B1": 35.9, "C1": 157.7, "D1": 172.8, "E1": 152.6, "F1": 159.6, "G1": 0, "H1": 0, "A2": 18.6, "B2": 82.8, "C2": 36.6, "D2": 53.7, "E2": 6.7, "F2": 6.3, "G2": 82.3, "H2": 13.1, "A3": 10.6, "B3": 6.3, "C3": 7.9, "D3": 76.3, "E3": 13.4, "F3": 106.3, "G3": 8.5, "H3": 97.0, "A4": 24.5, "B4": 78.1, "C4": 20.9, "D4": 55.2, "E4": 36.6, "F4": 85.0, "G4": 86.8, "H4": 8.6, "A5": 87.6, "B5": 6.6, "C5": 83.5, "D5": 51.3, "E5": 68.5, "F5": 8.2, "G5": 108.2, "H5": 7.4, "A6": 15.3, "B6": 92.0, "C6": 9.7, "D6": 83.6, "E6": 92.6, "F6": 60.8, "G6": 40.8, "H6": 7.3, "A7": 107.9, "B7": 61.2, "C7": 54.6, "D7": 85.9, "E7": 61.5, "F7": 8.9, "G7": 88.1, "H7": 64.4, "A8": 74.7, "B8": 12.8, "C8": 99.8, "D8": 98.9, "E8": 39.2, "F8": 41.7, "G8": 59.4, "H8": 69.9, "A9": 7.1, "B9": 6.5, "C9": 7.4, "D9": 62.5, "E9": 88.0, "F9": 6.9, "G9": 13.1, "H9": 62.4, "A10": 83.1, "B10": 67.0, "C10": 46.9, "D10": 6.9, "E10": 6.5, "F10": 86.2, "G10": 81.7, "H10": 81.0, "A11": 76.2, "B11": 14.3, "C11": 36.8, "D11": 84.5, "E11": 70.9, "F11": 42.9, "G11": 56.9, "H11": 6.3, "A12": 60.1, "B12": 100.6, "C12": 87.8, "D12": 8.5, "E12": 76.1, "F12": 74.3, "G12": 58.3, "H12": 87.3}},
	"WELL_MAX_VOLUME": 190.0,
}

metadata = {
        'protocolName': "PCE004__PCE012__PCE014__PCE031__P1__P2",
        'author': 'Kevin Murray',
        'apiLevel': '2.9',
}

def dispense_water_to(plate, water, well_vols, pipette):
    pipette.pick_up_tip()
    for well, volume in well_vols.items():
        if volume < pipette.min_volume:
            continue
        if volume > config["WELL_MAX_VOLUME"]:
            raise ValueError(f"ERROR! overfull well {well} on plate {plate}")
        transferred = 0
        while transferred < volume:
	    todo = volume-transferred
	    if todo > pipette.max_volume and todo <= pipette.max_volume*2:
	    	vol = todo/2
	    else:
                vol = min(todo, pipette.max_volume)
            pipette.aspirate(vol, water["A1"], rate=1)
            pipette.dispense(vol, plate[well], rate=1)
            transferred += vol
        pipette.blow_out(plate[well])
        pipette.touch_tip(plate[well])
    pipette.drop_tip()


def run(protocol: protocol_api.ProtocolContext):
    water = protocol.load_labware('integra_1_reservoir_150ml', 11)

    tiprack_p200 = protocol.load_labware('standard_96_tiprack_200ul', 10)
    p50 = protocol.load_instrument('p50_single', 'left', tip_racks=[tiprack_p200])
    p50.well_bottom_clearance.aspirate = 0
    p50.well_bottom_clearance.dispense = 0

    #tiprack_p10 = protocol.load_labware('standard_96_tiprack_10ul', 9)
    #p10 = protocol.load_instrument('p10_single', 'right', tip_racks=[tiprack_p10])
    #p10.well_bottom_clearance.aspirate = 0.5
    #p10.well_bottom_clearance.dispense = 0.5

    pos = 1
    for plate_name, well_vols in config["PLATES"].items():
        dest_plate = protocol.load_labware('axygen_96_wellplate_200ul', pos, label=plate_name)
        dispense_water_to(dest_plate, water, well_vols, p50)
	pos += 1
