from opentrons import protocol_api

config = {
    "PLATES": {"PCE030": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 16.6, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 5.9, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 29.7}, "PCE011": {"A1": 11.6, "B1": 50.8, "C1": 104.6, "D1": 81.4, "E1": 19.9, "F1": 46.2, "G1": 35.1, "H1": 10.5, "A2": 45.9, "B2": 0, "C2": 9.9, "D2": 15.5, "E2": 33.4, "F2": 6.7, "G2": 8.8, "H2": 20.3, "A3": 29.8, "B3": 0, "C3": 76.0, "D3": 83.8, "E3": 10.1, "F3": 149.7, "G3": 22.1, "H3": 24.5, "A4": 42.6, "B4": 74.5, "C4": 69.7, "D4": 78.2, "E4": 46.1, "F4": 15.1, "G4": 162.0, "H4": 59.9, "A5": 105.4, "B5": 39.1, "C5": 42.3, "D5": 15.8, "E5": 140.3, "F5": 32.6, "G5": 57.6, "H5": 11.4, "A6": 190.0, "B6": 31.3, "C6": 28.1, "D6": 48.4, "E6": 10.8, "F6": 32.1, "G6": 17.0, "H6": 58.4, "A7": 129.2, "B7": 88.0, "C7": 0, "D7": 15.8, "E7": 0, "F7": 20.3, "G7": 17.5, "H7": 11.4, "A8": 25.8, "B8": 11.5, "C8": 35.4, "D8": 33.4, "E8": 47.3, "F8": 190.0, "G8": 15.2, "H8": 10.3, "A9": 34.1, "B9": 57.1, "C9": 46.0, "D9": 7.2, "E9": 73.0, "F9": 17.9, "G9": 70.2, "H9": 68.0, "A10": 0, "B10": 6.4, "C10": 122.8, "D10": 21.6, "E10": 128.6, "F10": 87.7, "G10": 111.4, "H10": 153.9, "A11": 38.3, "B11": 129.3, "C11": 17.6, "D11": 45.4, "E11": 5.3, "F11": 9.9, "G11": 49.7, "H11": 37.5, "A12": 11.5, "B12": 10.8, "C12": 47.1, "D12": 34.0, "E12": 63.6, "F12": 53.8, "G12": 185.7, "H12": 8.7}, "PCE013": {"A1": 90.0, "B1": 27.3, "C1": 26.9, "D1": 13.1, "E1": 0, "F1": 0, "G1": 24.2, "H1": 126.5, "A2": 129.2, "B2": 129.5, "C2": 20.5, "D2": 25.7, "E2": 12.9, "F2": 8.2, "G2": 124.9, "H2": 55.5, "A3": 73.8, "B3": 42.7, "C3": 59.6, "D3": 55.2, "E3": 33.9, "F3": 5.4, "G3": 75.3, "H3": 0, "A4": 72.7, "B4": 30.4, "C4": 119.6, "D4": 16.0, "E4": 10.5, "F4": 11.1, "G4": 30.0, "H4": 17.5, "A5": 41.4, "B5": 13.5, "C5": 9.5, "D5": 32.0, "E5": 29.6, "F5": 90.6, "G5": 86.1, "H5": 0, "A6": 0, "B6": 156.3, "C6": 6.7, "D6": 41.5, "E6": 54.2, "F6": 0, "G6": 6.9, "H6": 43.8, "A7": 9.7, "B7": 0, "C7": 0, "D7": 15.8, "E7": 25.5, "F7": 113.2, "G7": 36.8, "H7": 16.3, "A8": 30.2, "B8": 6.3, "C8": 80.6, "D8": 140.1, "E8": 24.6, "F8": 17.2, "G8": 38.2, "H8": 0, "A9": 0, "B9": 60.8, "C9": 28.0, "D9": 21.3, "E9": 14.0, "F9": 59.1, "G9": 109.8, "H9": 35.3, "A10": 139.0, "B10": 156.0, "C10": 11.2, "D10": 0, "E10": 159.9, "F10": 56.3, "G10": 0, "H10": 111.5, "A11": 70.7, "B11": 7.1, "C11": 159.1, "D11": 151.7, "E11": 39.7, "F11": 128.6, "G11": 36.4, "H11": 25.2, "A12": 39.0, "B12": 0, "C12": 21.4, "D12": 72.2, "E12": 52.1, "F12": 136.8, "G12": 26.7, "H12": 28.5}, "PCE027": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 18.5, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 21.6, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PCE015": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PCE016": {"A1": 0, "B1": 0, "C1": 5.2, "D1": 0, "E1": 0, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 9.8, "C2": 0, "D2": 0, "E2": 0, "F2": 9.8, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 5.3, "G4": 0, "H4": 0, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 13.4, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 6.6, "A7": 17.5, "B7": 31.2, "C7": 8.0, "D7": 0, "E7": 10.0, "F7": 9.1, "G7": 0, "H7": 9.2, "A8": 5.5, "B8": 0, "C8": 6.1, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 13.4, "A9": 7.9, "B9": 0, "C9": 0, "D9": 21.4, "E9": 28.9, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 18.3, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 9.8, "G11": 9.8, "H11": 0, "A12": 10.9, "B12": 0, "C12": 5.1, "D12": 0, "E12": 0, "F12": 13.4, "G12": 0, "H12": 10.9}, "PCE017": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 7.0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 25.3, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PCE022": {"A1": 153.2, "B1": 0, "C1": 100.8, "D1": 147.5, "E1": 155.8, "F1": 0, "G1": 156.8, "H1": 125.0, "A2": 161.5, "B2": 14.1, "C2": 0, "D2": 176.5, "E2": 153.0, "F2": 141.1, "G2": 61.1, "H2": 13.2, "A3": 124.9, "B3": 152.0, "C3": 157.7, "D3": 158.8, "E3": 158.5, "F3": 52.1, "G3": 156.0, "H3": 121.6, "A4": 98.9, "B4": 138.5, "C4": 66.5, "D4": 125.7, "E4": 146.4, "F4": 45.6, "G4": 137.0, "H4": 151.4, "A5": 103.8, "B5": 123.6, "C5": 95.4, "D5": 137.9, "E5": 131.7, "F5": 131.7, "G5": 0, "H5": 134.2, "A6": 82.9, "B6": 151.3, "C6": 154.5, "D6": 147.1, "E6": 0, "F6": 144.4, "G6": 146.2, "H6": 0, "A7": 135.1, "B7": 87.3, "C7": 170.1, "D7": 137.0, "E7": 163.0, "F7": 68.2, "G7": 141.6, "H7": 31.1, "A8": 148.6, "B8": 120.1, "C8": 63.7, "D8": 137.9, "E8": 120.6, "F8": 166.0, "G8": 142.2, "H8": 130.8, "A9": 102.8, "B9": 133.5, "C9": 160.7, "D9": 127.3, "E9": 145.5, "F9": 122.6, "G9": 31.5, "H9": 128.3, "A10": 142.8, "B10": 35.8, "C10": 149.2, "D10": 111.1, "E10": 65.9, "F10": 68.3, "G10": 136.3, "H10": 109.3, "A11": 127.2, "B11": 119.0, "C11": 160.2, "D11": 165.1, "E11": 151.2, "F11": 161.2, "G11": 112.7, "H11": 36.8, "A12": 154.5, "B12": 165.7, "C12": 169.2, "D12": 169.4, "E12": 165.1, "F12": 145.0, "G12": 77.4, "H12": 128.8}, "PCE024": {"A1": 0, "B1": 178.6, "C1": 146.4, "D1": 166.6, "E1": 83.6, "F1": 170.3, "G1": 165.2, "H1": 41.2, "A2": 151.5, "B2": 135.3, "C2": 24.1, "D2": 142.3, "E2": 0, "F2": 158.5, "G2": 52.7, "H2": 102.9, "A3": 20.3, "B3": 0, "C3": 127.4, "D3": 138.9, "E3": 159.9, "F3": 0, "G3": 36.6, "H3": 137.9, "A4": 25.0, "B4": 138.2, "C4": 158.3, "D4": 145.5, "E4": 146.2, "F4": 106.5, "G4": 75.5, "H4": 0, "A5": 0, "B5": 165.9, "C5": 0, "D5": 77.2, "E5": 7.2, "F5": 158.7, "G5": 166.2, "H5": 183.8, "A6": 142.7, "B6": 149.3, "C6": 154.8, "D6": 172.6, "E6": 170.7, "F6": 0, "G6": 154.8, "H6": 178.0, "A7": 166.7, "B7": 173.2, "C7": 167.4, "D7": 150.3, "E7": 64.9, "F7": 0, "G7": 0, "H7": 0, "A8": 154.1, "B8": 161.0, "C8": 51.7, "D8": 161.3, "E8": 12.3, "F8": 176.4, "G8": 145.7, "H8": 0, "A9": 130.8, "B9": 139.3, "C9": 0, "D9": 113.8, "E9": 0, "F9": 137.5, "G9": 119.4, "H9": 62.9, "A10": 0, "B10": 115.2, "C10": 169.6, "D10": 177.2, "E10": 121.0, "F10": 160.4, "G10": 0, "H10": 188.9, "A11": 12.9, "B11": 173.1, "C11": 131.8, "D11": 177.8, "E11": 171.8, "F11": 156.0, "G11": 79.1, "H11": 148.5, "A12": 184.3, "B12": 19.5, "C12": 0, "D12": 165.8, "E12": 23.3, "F12": 0, "G12": 53.7, "H12": 70.3}},
    "WELL_MAX_VOLUME": 190.0,
}

metadata = {
        'protocolName': "PCE030__PCE011__PCE013__PCE027__PCE015__PCE016__PCE017__PCE022__PCE024",
        'author': 'Kevin Murray',
        'apiLevel': '2.9',
}

def dispense_water_to(plate, water, well_vols, pipette):
    pipette.pick_up_tip()
    for well, volume in well_vols.items():
        if volume < pipette.min_volume:
            continue
        if volume > config["WELL_MAX_VOLUME"]:
            raise ValueError(f"ERROR! overfull well {well} on plate {plate}")
        transferred = 0
        while transferred < volume:
            todo = volume-transferred
            if todo > pipette.max_volume and todo <= pipette.max_volume*2:
                vol = todo/2
            else:
                vol = min(todo, pipette.max_volume)
            pipette.aspirate(vol, water["A1"], rate=1)
            pipette.dispense(vol, plate[well], rate=1)
            transferred += vol
        pipette.blow_out(plate[well])
        pipette.touch_tip(plate[well])
    pipette.drop_tip()


def run(protocol: protocol_api.ProtocolContext):
    water = protocol.load_labware('integra_1_reservoir_150ml', 11)

    tiprack_p200 = protocol.load_labware('standard_96_tiprack_200ul', 10)
    p50 = protocol.load_instrument('p50_single', 'left', tip_racks=[tiprack_p200])
    p50.well_bottom_clearance.aspirate = 0
    p50.well_bottom_clearance.dispense = 0

    #tiprack_p10 = protocol.load_labware('standard_96_tiprack_10ul', 9)
    #p10 = protocol.load_instrument('p10_single', 'right', tip_racks=[tiprack_p10])
    #p10.well_bottom_clearance.aspirate = 0.5
    #p10.well_bottom_clearance.dispense = 0.5

    pos = 1
    for plate_name, well_vols in config["PLATES"].items():
        dest_plate = protocol.load_labware('axygen_96_wellplate_200ul', pos, label=plate_name)
        dispense_water_to(dest_plate, water, well_vols, p50)
        pos += 1
