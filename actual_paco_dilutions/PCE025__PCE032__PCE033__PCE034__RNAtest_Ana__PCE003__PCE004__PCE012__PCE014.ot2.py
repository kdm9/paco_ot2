from opentrons import protocol_api

config = {
    "PLATES": {"PCE025": {"A1": 15.0, "B1": 48.1, "C1": 166.3, "D1": 22.5, "E1": 5.0, "F1": 150.5, "G1": 0, "H1": 38.0, "A2": 117.7, "B2": 15.2, "C2": 121.5, "D2": 0, "E2": 118.2, "F2": 59.2, "G2": 90.1, "H2": 65.2, "A3": 110.7, "B3": 68.3, "C3": 123.9, "D3": 104.1, "E3": 11.6, "F3": 53.6, "G3": 150.6, "H3": 0, "A4": 74.9, "B4": 0, "C4": 48.0, "D4": 120.8, "E4": 0, "F4": 19.2, "G4": 70.3, "H4": 75.9, "A5": 140.7, "B5": 61.1, "C5": 132.0, "D5": 128.6, "E5": 16.4, "F5": 0, "G5": 40.7, "H5": 141.5, "A6": 146.2, "B6": 102.1, "C6": 0, "D6": 141.0, "E6": 45.2, "F6": 0, "G6": 45.8, "H6": 100.9, "A7": 51.9, "B7": 0, "C7": 77.7, "D7": 118.7, "E7": 125.9, "F7": 68.2, "G7": 64.2, "H7": 65.1, "A8": 16.9, "B8": 0, "C8": 0, "D8": 142.8, "E8": 56.4, "F8": 0, "G8": 0, "H8": 30.3, "A9": 18.8, "B9": 111.9, "C9": 21.1, "D9": 25.3, "E9": 69.8, "F9": 16.0, "G9": 104.1, "H9": 113.8, "A10": 0, "B10": 0, "C10": 145.9, "D10": 150.8, "E10": 52.8, "F10": 119.6, "G10": 0, "H10": 0, "A11": 33.6, "B11": 39.6, "C11": 124.9, "D11": 34.5, "E11": 30.1, "F11": 0, "G11": 0, "H11": 128.6, "A12": 0, "B12": 0, "C12": 0, "D12": 141.4, "E12": 136.7, "F12": 0, "G12": 122.9, "H12": 0}, "PCE032": {"A1": 0, "B1": 127.8, "C1": 128.1, "D1": 0, "E1": 118.6, "F1": 90.2, "G1": 0, "H1": 51.9, "A2": 138.1, "B2": 130.5, "C2": 45.9, "D2": 88.2, "E2": 0, "F2": 38.2, "G2": 0, "H2": 77.1, "A3": 99.5, "B3": 121.2, "C3": 0, "D3": 143.7, "E3": 158.8, "F3": 43.9, "G3": 0, "H3": 15.3, "A4": 72.9, "B4": 9.2, "C4": 77.5, "D4": 130.6, "E4": 15.2, "F4": 152.9, "G4": 36.1, "H4": 0, "A5": 148.0, "B5": 127.8, "C5": 0, "D5": 0, "E5": 129.6, "F5": 0, "G5": 121.8, "H5": 105.1, "A6": 21.5, "B6": 0, "C6": 130.8, "D6": 106.9, "E6": 124.8, "F6": 93.8, "G6": 136.5, "H6": 138.2, "A7": 48.3, "B7": 111.2, "C7": 88.6, "D7": 0, "E7": 90.4, "F7": 0, "G7": 0, "H7": 57.6, "A8": 0, "B8": 71.7, "C8": 122.1, "D8": 34.3, "E8": 0, "F8": 0, "G8": 0, "H8": 75.0, "A9": 0, "B9": 104.6, "C9": 91.2, "D9": 82.3, "E9": 28.9, "F9": 99.8, "G9": 107.7, "H9": 107.0, "A10": 144.6, "B10": 171.0, "C10": 127.3, "D10": 95.0, "E10": 131.5, "F10": 143.6, "G10": 59.6, "H10": 50.9, "A11": 155.1, "B11": 37.2, "C11": 0, "D11": 19.4, "E11": 14.4, "F11": 6.1, "G11": 6.9, "H11": 53.3, "A12": 99.3, "B12": 0, "C12": 88.0, "D12": 130.5, "E12": 46.3, "F12": 142.5, "G12": 27.3, "H12": 9.4}, "PCE033": {"A1": 17.7, "B1": 0, "C1": 133.9, "D1": 0, "E1": 53.2, "F1": 0, "G1": 80.7, "H1": 6.6, "A2": 0, "B2": 0, "C2": 67.9, "D2": 0, "E2": 32.4, "F2": 31.8, "G2": 67.1, "H2": 50.6, "A3": 89.2, "B3": 27.6, "C3": 96.4, "D3": 31.4, "E3": 0, "F3": 0, "G3": 15.7, "H3": 25.8, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 182.0, "F4": 57.3, "G4": 0, "H4": 18.1, "A5": 160.0, "B5": 74.1, "C5": 0, "D5": 53.2, "E5": 0, "F5": 0, "G5": 45.1, "H5": 108.6, "A6": 0, "B6": 0, "C6": 173.7, "D6": 0, "E6": 0, "F6": 59.8, "G6": 190.0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 111.5, "F7": 0, "G7": 23.8, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 15.1, "E8": 0, "F8": 0, "G8": 57.4, "H8": 0, "A9": 47.1, "B9": 6.3, "C9": 24.2, "D9": 0, "E9": 0, "F9": 0, "G9": 6.3, "H9": 152.7, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 60.0, "G10": 19.0, "H10": 20.8}, "PCE034": {"A1": 58.2, "B1": 0, "C1": 0, "D1": 0, "E1": 23.0, "F1": 5.1, "G1": 6.3, "H1": 0, "A2": 0, "B2": 0, "C2": 190.0, "D2": 0, "E2": 11.7, "F2": 190.0, "G2": 0, "H2": 190.0, "A3": 9.4, "B3": 5.2, "C3": 53.4, "D3": 0, "E3": 0, "F3": 174.5, "G3": 0, "H3": 36.0, "A4": 0, "B4": 21.1, "C4": 190.0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 70.4, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "RNAtest_Ana": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 5.6, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0}, "PCE003": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PCE004": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 7.2, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 17.9, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 12.8, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PCE012": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 6.1, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 11.7, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 18.4, "G5": 0, "H5": 8.7, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 21.8, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 15.6, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 91.5, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 78.2, "B11": 6.4, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 12.5, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PCE014": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 0, "G1": 8.5, "H1": 36.6, "A2": 0, "B2": 0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 6.4, "H2": 8.6, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 15.4, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 26.9, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 5.1, "A6": 0, "B6": 0, "C6": 0, "D6": 21.8, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 5.8, "E8": 0, "F8": 5.7, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}},
    "WELL_MAX_VOLUME": 190.0,
}

metadata = {
        'protocolName': "PCE025__PCE032__PCE033__PCE034__RNAtest_Ana__PCE003__PCE004__PCE012__PCE014",
        'author': 'Kevin Murray',
        'apiLevel': '2.9',
}

def dispense_water_to(plate, water, well_vols, pipette):
    pipette.pick_up_tip()
    for well, volume in well_vols.items():
        if volume < pipette.min_volume:
            continue
        if volume > config["WELL_MAX_VOLUME"]:
            raise ValueError(f"ERROR! overfull well {well} on plate {plate}")
        transferred = 0
        while transferred < volume:
            todo = volume-transferred
            if todo > pipette.max_volume and todo <= pipette.max_volume*2:
                vol = todo/2
            else:
                vol = min(todo, pipette.max_volume)
            pipette.aspirate(vol, water["A1"], rate=1)
            pipette.dispense(vol, plate[well], rate=1)
            transferred += vol
        pipette.blow_out(plate[well])
        pipette.touch_tip(plate[well])
    pipette.drop_tip()


def run(protocol: protocol_api.ProtocolContext):
    water = protocol.load_labware('integra_1_reservoir_150ml', 11)

    tiprack_p200 = protocol.load_labware('standard_96_tiprack_200ul', 10)
    p50 = protocol.load_instrument('p50_single', 'left', tip_racks=[tiprack_p200])
    p50.well_bottom_clearance.aspirate = 0
    p50.well_bottom_clearance.dispense = 0

    #tiprack_p10 = protocol.load_labware('standard_96_tiprack_10ul', 9)
    #p10 = protocol.load_instrument('p10_single', 'right', tip_racks=[tiprack_p10])
    #p10.well_bottom_clearance.aspirate = 0.5
    #p10.well_bottom_clearance.dispense = 0.5

    pos = 1
    for plate_name, well_vols in config["PLATES"].items():
        dest_plate = protocol.load_labware('axygen_96_wellplate_200ul', pos, label=plate_name)
        dispense_water_to(dest_plate, water, well_vols, p50)
        pos += 1
