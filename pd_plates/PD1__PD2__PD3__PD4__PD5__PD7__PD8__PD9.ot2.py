from opentrons import protocol_api

config = {
    "PLATES": {"PD1": {"A1": 45.8, "B1": 9.4, "C1": 10.0, "D1": 15.0, "E1": 0, "F1": 50.5, "G1": 15.7, "H1": 0, "A2": 0, "B2": 0, "C2": 49.9, "D2": 0, "E2": 21.3, "F2": 0, "G2": 52.5, "H2": 5.2, "A3": 0, "B3": 0, "C3": 70.8, "D3": 48.6, "E3": 0, "F3": 46.6, "G3": 17.2, "H3": 24.3, "A4": 20.7, "B4": 9.5, "C4": 0, "D4": 0, "E4": 11.9, "F4": 43.5, "G4": 0, "H4": 0, "A5": 57.8, "B5": 0, "C5": 0, "D5": 10.9, "E5": 0, "F5": 7.2, "G5": 56.5, "H5": 0, "A6": 18.9, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 5.2, "G6": 0, "H6": 5.8, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 56.3, "F7": 22.4, "G7": 0, "H7": 0, "A8": 15.7, "B8": 57.3, "C8": 0, "D8": 0, "E8": 32.1, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 39.9, "C10": 0, "D10": 42.7, "E10": 0, "F10": 0, "G10": 0, "H10": 56.6, "A11": 0, "B11": 5.2, "C11": 0, "D11": 35.8, "E11": 61.2, "F11": 0, "G11": 16.5, "H11": 29.0, "A12": 0, "B12": 0, "C12": 28.9, "D12": 0, "E12": 0, "F12": 117.1, "G12": 82.6, "H12": 9.9}, "PD2": {"A1": 22.7, "B1": 20.9, "C1": 11.8, "D1": 27.2, "E1": 11.2, "F1": 0, "G1": 0, "H1": 26.6, "A2": 15.3, "B2": 61.2, "C2": 37.1, "D2": 0, "E2": 0, "F2": 10.0, "G2": 0, "H2": 0, "A3": 9.9, "B3": 0, "C3": 6.0, "D3": 0, "E3": 0, "F3": 31.0, "G3": 25.0, "H3": 0, "A4": 0, "B4": 7.6, "C4": 27.3, "D4": 11.2, "E4": 0, "F4": 0, "G4": 0, "H4": 32.9, "A5": 0, "B5": 8.7, "C5": 0, "D5": 0, "E5": 20.9, "F5": 65.4, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 16.7, "D6": 48.5, "E6": 7.4, "F6": 0, "G6": 19.6, "H6": 91.2, "A7": 0, "B7": 0, "C7": 60.3, "D7": 10.8, "E7": 0, "F7": 16.5, "G7": 22.8, "H7": 15.9, "A8": 15.7, "B8": 13.5, "C8": 31.4, "D8": 0, "E8": 0, "F8": 24.0, "G8": 0, "H8": 12.4, "A9": 13.0, "B9": 96.2, "C9": 8.8, "D9": 0, "E9": 0, "F9": 0, "G9": 25.2, "H9": 91.7, "A10": 17.1, "B10": 29.7, "C10": 12.5, "D10": 7.4, "E10": 78.9, "F10": 84.8, "G10": 94.9, "H10": 26.3, "A11": 37.4, "B11": 0, "C11": 6.7, "D11": 76.0, "E11": 8.4, "F11": 64.1, "G11": 20.0, "H11": 22.7, "A12": 7.2, "B12": 0, "C12": 67.6, "D12": 23.8, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PD3": {"A1": 0, "B1": 0, "C1": 0, "D1": 26.2, "E1": 0, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 46.1, "C2": 0, "D2": 0, "E2": 19.1, "F2": 0, "G2": 0, "H2": 0, "A3": 22.2, "B3": 0, "C3": 10.8, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 9.6, "B4": 5.3, "C4": 0, "D4": 19.1, "E4": 0, "F4": 15.0, "G4": 7.1, "H4": 0, "A5": 51.2, "B5": 8.6, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 9.5, "A6": 0, "B6": 0, "C6": 24.7, "D6": 8.8, "E6": 6.0, "F6": 20.3, "G6": 17.2, "H6": 51.1, "A7": 45.9, "B7": 29.0, "C7": 9.4, "D7": 0, "E7": 0, "F7": 6.3, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 7.5, "F8": 0, "G8": 10.5, "H8": 0, "A9": 0, "B9": 5.9, "C9": 24.7, "D9": 0, "E9": 24.8, "F9": 20.5, "G9": 8.0, "H9": 8.0, "A10": 5.6, "B10": 32.8, "C10": 6.4, "D10": 0, "E10": 0, "F10": 0, "G10": 91.7, "H10": 41.2, "A11": 0, "B11": 0, "C11": 17.0, "D11": 0, "E11": 22.4, "F11": 0, "G11": 28.0, "H11": 15.4, "A12": 14.7, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PD4": {"A1": 0, "B1": 0, "C1": 0, "D1": 14.4, "E1": 0, "F1": 57.2, "G1": 40.2, "H1": 58.5, "A2": 10.6, "B2": 35.1, "C2": 0, "D2": 33.4, "E2": 6.4, "F2": 0, "G2": 0, "H2": 0, "A3": 35.6, "B3": 28.8, "C3": 11.1, "D3": 45.0, "E3": 25.5, "F3": 0, "G3": 13.7, "H3": 0, "A4": 41.8, "B4": 22.0, "C4": 22.0, "D4": 0, "E4": 22.1, "F4": 18.2, "G4": 31.8, "H4": 0, "A5": 58.0, "B5": 0, "C5": 24.4, "D5": 0, "E5": 0, "F5": 21.0, "G5": 69.4, "H5": 52.3, "A6": 23.0, "B6": 20.5, "C6": 24.8, "D6": 0, "E6": 25.8, "F6": 0, "G6": 25.3, "H6": 0, "A7": 0, "B7": 8.7, "C7": 0, "D7": 32.7, "E7": 56.3, "F7": 0, "G7": 7.7, "H7": 0, "A8": 10.0, "B8": 55.9, "C8": 0, "D8": 0, "E8": 39.0, "F8": 22.9, "G8": 50.8, "H8": 0, "A9": 38.1, "B9": 0, "C9": 13.2, "D9": 9.4, "E9": 10.8, "F9": 57.7, "G9": 0, "H9": 0, "A10": 36.8, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 37.4, "G10": 25.5, "H10": 16.4, "A11": 0, "B11": 0, "C11": 16.8, "D11": 37.1, "E11": 26.9, "F11": 87.5, "G11": 9.7, "H11": 53.7, "A12": 0, "B12": 0, "C12": 10.7, "D12": 27.7, "E12": 0, "F12": 35.5, "G12": 41.1, "H12": 0}, "PD5": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 10.1, "G1": 0, "H1": 0, "A2": 0, "B2": 13.0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 8.7, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 9.4, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 5.5, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 10.2, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 39.6}, "PD7": {"A1": 16.6, "B1": 48.5, "C1": 0, "D1": 40.0, "E1": 8.1, "F1": 39.3, "G1": 61.3, "H1": 10.9, "A2": 50.1, "B2": 6.3, "C2": 0, "D2": 0, "E2": 0, "F2": 5.6, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 6.3, "D3": 6.4, "E3": 40.8, "F3": 17.5, "G3": 5.3, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 6.7, "E4": 0, "F4": 19.1, "G4": 24.6, "H4": 0, "A5": 26.8, "B5": 46.6, "C5": 0, "D5": 15.2, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 5.0, "C6": 0, "D6": 0, "E6": 0, "F6": 30.6, "G6": 7.8, "H6": 0, "A7": 23.5, "B7": 15.6, "C7": 12.3, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 5.0, "D11": 0, "E11": 17.1, "F11": 31.9, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 11.7, "D12": 19.3, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PD8": {"A1": 78.7, "B1": 25.3, "C1": 83.6, "D1": 0, "E1": 0, "F1": 137.9, "G1": 73.1, "H1": 180, "A2": 101.3, "B2": 114.1, "C2": 53.9, "D2": 110.4, "E2": 44.8, "F2": 16.6, "G2": 77.0, "H2": 62.2, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 0, "B5": 0, "C5": 0, "D5": 59.3, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 22.9, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 41.6, "B7": 94.4, "C7": 39.8, "D7": 109.7, "E7": 98.0, "F7": 39.7, "G7": 27.4, "H7": 0, "A8": 42.6, "B8": 107.5, "C8": 57.9, "D8": 73.2, "E8": 72.2, "F8": 122.2, "G8": 35.6, "H8": 0, "A9": 96.9, "B9": 10.8, "C9": 33.8, "D9": 115.4, "E9": 69.3, "F9": 20.6, "G9": 51.3, "H9": 0, "A10": 31.9, "B10": 50.5, "C10": 96.1, "D10": 52.9, "E10": 0, "F10": 73.9, "G10": 0, "H10": 0, "A11": 91.0, "B11": 0, "C11": 0, "D11": 92.1, "E11": 79.4, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 165.8, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PD9": {"A1": 0, "B1": 0, "C1": 26.9, "D1": 51.6, "E1": 0, "F1": 52.5, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 14.6, "E2": 0, "F2": 19.9, "G2": 11.2, "H2": 30.4, "A3": 21.1, "B3": 16.3, "C3": 8.7, "D3": 24.1, "E3": 45.8, "F3": 0, "G3": 0, "H3": 76.4, "A4": 0, "B4": 8.5, "C4": 0, "D4": 0, "E4": 0, "F4": 24.2, "G4": 31.9, "H4": 29.5, "A5": 0, "B5": 0, "C5": 0, "D5": 38.5, "E5": 35.0, "F5": 0, "G5": 17.6, "H5": 0, "A6": 26.1, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 19.3, "D7": 0, "E7": 0, "F7": 0, "G7": 20.6, "H7": 0, "A8": 0, "B8": 23.8, "C8": 0, "D8": 0, "E8": 0, "F8": 22.5, "G8": 6.6, "H8": 14.4, "A9": 0, "B9": 0, "C9": 5.9, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 16.2, "C10": 0, "D10": 31.7, "E10": 0, "F10": 0, "G10": 0, "H10": 17.2, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 22.2, "A12": 0, "B12": 0, "C12": 0, "D12": 8.4, "E12": 0, "F12": 0, "G12": 0, "H12": 0}},
    "WELL_MAX_VOLUME": 180,
}

metadata = {
        'protocolName': "PD1__PD2__PD3__PD4__PD5__PD7__PD8__PD9",
        'author': 'Kevin Murray',
        'apiLevel': '2.9',
}

def dispense_water_to(plate, water, well_vols, pipette):
    pipette.pick_up_tip()
    for well, volume in well_vols.items():
        if volume < pipette.min_volume:
            continue
        if volume > config["WELL_MAX_VOLUME"]:
            raise ValueError(f"ERROR! overfull well {well} on plate {plate}")
        transferred = 0
        while transferred < volume:
            todo = volume-transferred
            if todo > pipette.max_volume and todo <= pipette.max_volume*2:
                vol = todo/2
            else:
                vol = min(todo, pipette.max_volume)
            pipette.aspirate(vol, water["A1"], rate=1)
            pipette.dispense(vol, plate[well], rate=1)
            transferred += vol
        pipette.blow_out(plate[well])
        pipette.touch_tip(plate[well])
    pipette.drop_tip()


def run(protocol: protocol_api.ProtocolContext):
    water = protocol.load_labware('integra_1_reservoir_150ml', 11)

    tiprack_p200 = protocol.load_labware('standard_96_tiprack_200ul', 10)
    p50 = protocol.load_instrument('p50_single', 'left', tip_racks=[tiprack_p200])
    p50.well_bottom_clearance.aspirate = 0
    p50.well_bottom_clearance.dispense = 0

    #tiprack_p10 = protocol.load_labware('standard_96_tiprack_10ul', 9)
    #p10 = protocol.load_instrument('p10_single', 'right', tip_racks=[tiprack_p10])
    #p10.well_bottom_clearance.aspirate = 0.5
    #p10.well_bottom_clearance.dispense = 0.5

    pos = 1
    for plate_name, well_vols in config["PLATES"].items():
        dest_plate = protocol.load_labware('axygen_96_wellplate_200ul', pos, label=plate_name)
        dispense_water_to(dest_plate, water, well_vols, p50)
        pos += 1
