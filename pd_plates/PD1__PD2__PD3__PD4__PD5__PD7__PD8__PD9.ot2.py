from opentrons import protocol_api

config = {
    "PLATES": {"PD1": {"A1": 36.6, "B1": 7.5, "C1": 8.0, "D1": 12.0, "E1": 0, "F1": 40.4, "G1": 12.5, "H1": 0, "A2": 0, "B2": 0, "C2": 39.9, "D2": 0, "E2": 17.0, "F2": 0, "G2": 42.0, "H2": 0, "A3": 0, "B3": 0, "C3": 56.7, "D3": 38.9, "E3": 0, "F3": 37.3, "G3": 13.7, "H3": 19.4, "A4": 16.5, "B4": 7.6, "C4": 0, "D4": 0, "E4": 9.5, "F4": 34.8, "G4": 0, "H4": 0, "A5": 46.3, "B5": 0, "C5": 0, "D5": 8.7, "E5": 0, "F5": 5.8, "G5": 45.2, "H5": 0, "A6": 15.1, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 45.1, "F7": 18.0, "G7": 0, "H7": 0, "A8": 12.6, "B8": 45.8, "C8": 0, "D8": 0, "E8": 25.7, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 31.9, "C10": 0, "D10": 34.2, "E10": 0, "F10": 0, "G10": 0, "H10": 45.3, "A11": 0, "B11": 0, "C11": 0, "D11": 28.6, "E11": 48.9, "F11": 0, "G11": 13.2, "H11": 23.2, "A12": 0, "B12": 0, "C12": 23.1, "D12": 0, "E12": 0, "F12": 93.7, "G12": 66.0, "H12": 7.9}, "PD2": {"A1": 18.2, "B1": 16.7, "C1": 9.5, "D1": 21.8, "E1": 9.0, "F1": 0, "G1": 0, "H1": 21.3, "A2": 12.3, "B2": 49.0, "C2": 29.7, "D2": 0, "E2": 0, "F2": 8.0, "G2": 0, "H2": 0, "A3": 7.9, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 24.8, "G3": 20.0, "H3": 0, "A4": 0, "B4": 6.0, "C4": 21.9, "D4": 9.0, "E4": 0, "F4": 0, "G4": 0, "H4": 26.3, "A5": 0, "B5": 6.9, "C5": 0, "D5": 0, "E5": 16.7, "F5": 52.3, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 13.4, "D6": 38.8, "E6": 5.9, "F6": 0, "G6": 15.7, "H6": 72.9, "A7": 0, "B7": 0, "C7": 48.2, "D7": 8.6, "E7": 0, "F7": 13.2, "G7": 18.3, "H7": 12.7, "A8": 12.5, "B8": 10.8, "C8": 25.1, "D8": 0, "E8": 0, "F8": 19.2, "G8": 0, "H8": 9.9, "A9": 10.4, "B9": 77.0, "C9": 7.1, "D9": 0, "E9": 0, "F9": 0, "G9": 20.2, "H9": 73.4, "A10": 13.7, "B10": 23.8, "C10": 10.0, "D10": 5.9, "E10": 63.1, "F10": 67.8, "G10": 75.9, "H10": 21.0, "A11": 29.9, "B11": 0, "C11": 5.3, "D11": 60.8, "E11": 6.7, "F11": 51.3, "G11": 16.0, "H11": 18.2, "A12": 5.8, "B12": 0, "C12": 54.1, "D12": 19.1, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PD3": {"A1": 0, "B1": 0, "C1": 0, "D1": 20.9, "E1": 0, "F1": 0, "G1": 0, "H1": 0, "A2": 0, "B2": 36.9, "C2": 0, "D2": 0, "E2": 15.3, "F2": 0, "G2": 0, "H2": 0, "A3": 17.8, "B3": 0, "C3": 8.7, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 7.7, "B4": 0, "C4": 0, "D4": 15.3, "E4": 0, "F4": 12.0, "G4": 5.7, "H4": 0, "A5": 40.9, "B5": 6.9, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 7.6, "A6": 0, "B6": 0, "C6": 19.8, "D6": 7.0, "E6": 0, "F6": 16.3, "G6": 13.8, "H6": 40.9, "A7": 36.7, "B7": 23.2, "C7": 7.5, "D7": 0, "E7": 0, "F7": 5.0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 6.0, "F8": 0, "G8": 8.4, "H8": 0, "A9": 0, "B9": 0, "C9": 19.8, "D9": 0, "E9": 19.8, "F9": 16.4, "G9": 6.4, "H9": 6.4, "A10": 0, "B10": 26.2, "C10": 5.1, "D10": 0, "E10": 0, "F10": 0, "G10": 73.4, "H10": 33.0, "A11": 0, "B11": 0, "C11": 13.6, "D11": 0, "E11": 17.9, "F11": 0, "G11": 22.4, "H11": 12.3, "A12": 11.7, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PD4": {"A1": 0, "B1": 0, "C1": 0, "D1": 11.5, "E1": 0, "F1": 45.8, "G1": 32.2, "H1": 46.8, "A2": 8.5, "B2": 28.0, "C2": 0, "D2": 26.7, "E2": 5.1, "F2": 0, "G2": 0, "H2": 0, "A3": 28.5, "B3": 23.0, "C3": 8.9, "D3": 36.0, "E3": 20.4, "F3": 0, "G3": 11.0, "H3": 0, "A4": 33.4, "B4": 17.6, "C4": 17.6, "D4": 0, "E4": 17.7, "F4": 14.6, "G4": 25.4, "H4": 0, "A5": 46.4, "B5": 0, "C5": 19.5, "D5": 0, "E5": 0, "F5": 16.8, "G5": 55.5, "H5": 41.9, "A6": 18.4, "B6": 16.4, "C6": 19.8, "D6": 0, "E6": 20.7, "F6": 0, "G6": 20.2, "H6": 0, "A7": 0, "B7": 7.0, "C7": 0, "D7": 26.2, "E7": 45.0, "F7": 0, "G7": 6.2, "H7": 0, "A8": 8.0, "B8": 44.7, "C8": 0, "D8": 0, "E8": 31.2, "F8": 18.3, "G8": 40.7, "H8": 0, "A9": 30.5, "B9": 0, "C9": 10.5, "D9": 7.5, "E9": 8.6, "F9": 46.2, "G9": 0, "H9": 0, "A10": 29.5, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 29.9, "G10": 20.4, "H10": 13.1, "A11": 0, "B11": 0, "C11": 13.4, "D11": 29.7, "E11": 21.5, "F11": 70.0, "G11": 7.7, "H11": 42.9, "A12": 0, "B12": 0, "C12": 8.5, "D12": 22.2, "E12": 0, "F12": 28.4, "G12": 32.9, "H12": 0}, "PD5": {"A1": 0, "B1": 0, "C1": 0, "D1": 0, "E1": 0, "F1": 8.1, "G1": 0, "H1": 0, "A2": 0, "B2": 10.4, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 6.9, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 0, "B5": 0, "C5": 0, "D5": 0, "E5": 0, "F5": 0, "G5": 0, "H5": 7.5, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 0, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 8.1, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 31.7}, "PD7": {"A1": 13.2, "B1": 38.8, "C1": 0, "D1": 32.0, "E1": 6.5, "F1": 31.5, "G1": 49.0, "H1": 8.7, "A2": 40.1, "B2": 5.0, "C2": 0, "D2": 0, "E2": 0, "F2": 0, "G2": 0, "H2": 0, "A3": 0, "B3": 0, "C3": 5.1, "D3": 5.2, "E3": 32.6, "F3": 14.0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 5.4, "E4": 0, "F4": 15.3, "G4": 19.7, "H4": 0, "A5": 21.4, "B5": 37.2, "C5": 0, "D5": 12.1, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 24.5, "G6": 6.2, "H6": 0, "A7": 18.8, "B7": 12.5, "C7": 9.8, "D7": 0, "E7": 0, "F7": 0, "G7": 0, "H7": 0, "A8": 0, "B8": 0, "C8": 0, "D8": 0, "E8": 0, "F8": 0, "G8": 0, "H8": 0, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 0, "C10": 0, "D10": 0, "E10": 0, "F10": 0, "G10": 0, "H10": 0, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 13.7, "F11": 25.5, "G11": 0, "H11": 0, "A12": 0, "B12": 0, "C12": 9.4, "D12": 15.4, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PD8": {"A1": 63.0, "B1": 20.3, "C1": 66.9, "D1": 0, "E1": 0, "F1": 110.4, "G1": 58.5, "H1": 156.6, "A2": 81.0, "B2": 91.3, "C2": 43.1, "D2": 88.3, "E2": 35.8, "F2": 13.3, "G2": 61.6, "H2": 49.8, "A3": 0, "B3": 0, "C3": 0, "D3": 0, "E3": 0, "F3": 0, "G3": 0, "H3": 0, "A4": 0, "B4": 0, "C4": 0, "D4": 0, "E4": 0, "F4": 0, "G4": 0, "H4": 0, "A5": 0, "B5": 0, "C5": 0, "D5": 47.4, "E5": 0, "F5": 0, "G5": 0, "H5": 0, "A6": 0, "B6": 0, "C6": 18.3, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 33.3, "B7": 75.5, "C7": 31.8, "D7": 87.7, "E7": 78.4, "F7": 31.8, "G7": 21.9, "H7": 0, "A8": 34.1, "B8": 86.0, "C8": 46.3, "D8": 58.5, "E8": 57.7, "F8": 97.8, "G8": 28.5, "H8": 0, "A9": 77.6, "B9": 8.6, "C9": 27.1, "D9": 92.3, "E9": 55.4, "F9": 16.5, "G9": 41.0, "H9": 0, "A10": 25.5, "B10": 40.4, "C10": 76.9, "D10": 42.3, "E10": 0, "F10": 59.1, "G10": 0, "H10": 0, "A11": 72.8, "B11": 0, "C11": 0, "D11": 73.6, "E11": 63.5, "F11": 0, "G11": 0, "H11": 0, "A12": 0, "B12": 132.7, "C12": 0, "D12": 0, "E12": 0, "F12": 0, "G12": 0, "H12": 0}, "PD9": {"A1": 0, "B1": 0, "C1": 21.5, "D1": 41.3, "E1": 0, "F1": 42.0, "G1": 0, "H1": 0, "A2": 0, "B2": 0, "C2": 0, "D2": 11.7, "E2": 0, "F2": 15.9, "G2": 9.0, "H2": 24.3, "A3": 16.9, "B3": 13.1, "C3": 6.9, "D3": 19.2, "E3": 36.6, "F3": 0, "G3": 0, "H3": 61.1, "A4": 0, "B4": 6.8, "C4": 0, "D4": 0, "E4": 0, "F4": 19.4, "G4": 25.5, "H4": 23.6, "A5": 0, "B5": 0, "C5": 0, "D5": 30.8, "E5": 28.0, "F5": 0, "G5": 14.1, "H5": 0, "A6": 20.9, "B6": 0, "C6": 0, "D6": 0, "E6": 0, "F6": 0, "G6": 0, "H6": 0, "A7": 0, "B7": 0, "C7": 15.5, "D7": 0, "E7": 0, "F7": 0, "G7": 16.4, "H7": 0, "A8": 0, "B8": 19.1, "C8": 0, "D8": 0, "E8": 0, "F8": 18.0, "G8": 5.3, "H8": 11.5, "A9": 0, "B9": 0, "C9": 0, "D9": 0, "E9": 0, "F9": 0, "G9": 0, "H9": 0, "A10": 0, "B10": 13.0, "C10": 0, "D10": 25.4, "E10": 0, "F10": 0, "G10": 0, "H10": 13.8, "A11": 0, "B11": 0, "C11": 0, "D11": 0, "E11": 0, "F11": 0, "G11": 0, "H11": 17.8, "A12": 0, "B12": 0, "C12": 0, "D12": 6.7, "E12": 0, "F12": 0, "G12": 0, "H12": 0}},
    "WELL_MAX_VOLUME": 180,
}

metadata = {
        'protocolName': "PD1__PD2__PD3__PD4__PD5__PD7__PD8__PD9",
        'author': 'Kevin Murray',
        'apiLevel': '2.9',
}

def dispense_water_to(plate, water, well_vols, pipette):
    pipette.pick_up_tip()
    for well, volume in well_vols.items():
        if volume < pipette.min_volume:
            continue
        if volume > config["WELL_MAX_VOLUME"]:
            raise ValueError(f"ERROR! overfull well {well} on plate {plate}")
        transferred = 0
        while transferred < volume:
            todo = volume-transferred
            if todo > pipette.max_volume and todo <= pipette.max_volume*2:
                vol = todo/2
            else:
                vol = min(todo, pipette.max_volume)
            pipette.aspirate(vol, water["A1"], rate=1)
            pipette.dispense(vol, plate[well], rate=1)
            transferred += vol
        pipette.blow_out(plate[well])
        pipette.touch_tip(plate[well])
    pipette.drop_tip()


def run(protocol: protocol_api.ProtocolContext):
    water = protocol.load_labware('integra_1_reservoir_150ml', 11)

    tiprack_p200 = protocol.load_labware('standard_96_tiprack_200ul', 10)
    p50 = protocol.load_instrument('p50_single', 'left', tip_racks=[tiprack_p200])
    p50.well_bottom_clearance.aspirate = 0
    p50.well_bottom_clearance.dispense = 0

    #tiprack_p10 = protocol.load_labware('standard_96_tiprack_10ul', 9)
    #p10 = protocol.load_instrument('p10_single', 'right', tip_racks=[tiprack_p10])
    #p10.well_bottom_clearance.aspirate = 0.5
    #p10.well_bottom_clearance.dispense = 0.5

    pos = 1
    for plate_name, well_vols in config["PLATES"].items():
        dest_plate = protocol.load_labware('axygen_96_wellplate_200ul', pos, label=plate_name)
        dispense_water_to(dest_plate, water, well_vols, p50)
        pos += 1
